{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'course_css/add-course.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-4">📝 Create New Course</h2>

  <form method="POST">
    {% csrf_token %}
    <fieldset>
      <legend class="w-auto">Course Information</legend>

      <div class="mb-2">
        <label for="course_name">Course Name:</label>
        <input type="text" name="course_name" id="course_name" class="form-control" placeholder="Enter course name" required>
      </div>

      <div class="mb-2">
        <div class="button-group">
          <button type="button" id="sub_course_btn" class="btn btn-info" style="background-color: #17a2b8; color: white; padding: 0.6rem 1.2rem; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">
            📚 Sub Course
          </button>
          <button type="button" id="add_more_btn" class="btn btn-success" style="background-color: #28a745; color: white; padding: 0.6rem 1.2rem; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-left: 10px;">
            ➕
          </button>
        </div>
      </div>

      <div id="sub_courses_container" class="mb-2">
        <!-- Sub course input boxes will be added here -->
      </div>
    </fieldset>

    <button type="submit" class="btn-success">Continue to Add Course Form</button>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const subCourseBtn = document.getElementById('sub_course_btn');
  const addMoreBtn = document.getElementById('add_more_btn');
  const courseNameInput = document.getElementById('course_name');
  const subCoursesContainer = document.getElementById('sub_courses_container');
  let subCourseCounter = 0;
  
  // Function to create a sub course input box
  function createSubCourseInput() {
    subCourseCounter++;
    const inputDiv = document.createElement('div');
    inputDiv.className = 'sub-course-input mb-2';
    inputDiv.innerHTML = `
      <div style="display: flex; align-items: center; gap: 10px;">
        <input type="text" name="sub_course_${subCourseCounter}" class="form-control" placeholder="Enter sub course name" style="flex: 1;">
        <button type="button" class="btn btn-danger remove-sub-course" style="background-color: #dc3545; color: white; padding: 0.5rem 0.75rem; border: none; border-radius: 4px; cursor: pointer;">❌</button>
      </div>
    `;
    
    // Add remove functionality
    const removeBtn = inputDiv.querySelector('.remove-sub-course');
    removeBtn.addEventListener('click', function() {
      inputDiv.remove();
    });
    
    return inputDiv;
  }
  
  // Sub Course button functionality
  subCourseBtn.addEventListener('click', function() {
    const courseName = courseNameInput.value.trim();
    if (!courseName) {
      alert('Please enter a course name first!');
      return;
    }
    
    // Define sub course options based on course name (case-insensitive)
    const subCourseOptions = {
      'it': ['Web Development', 'Data Science', 'Networking', 'Cyber Security'],
      'engineering': ['Computer Science Engineering (CSE)', 'Mechanical Engineering', 'Civil Engineering', 'Electrical Engineering'],
      'medical': ['MBBS (Bachelor of Medicine & Bachelor of Surgery)', 'BDS (Bachelor of Dental Surgery)', 'BAMS (Ayurveda)', 'BHMS (Homeopathy)'],
      'business': ['Accounting', 'Marketing', 'Finance', 'Human Resources'],
      'arts': ['Painting', 'Music', 'Dance', 'Literature'],
      'science': ['Physics', 'Chemistry', 'Biology', 'Mathematics']
    };
    
    const normalizedCourseName = courseName.toLowerCase();
    const options = subCourseOptions[normalizedCourseName] || [];
    
    if (options.length > 0) {
      let message = `Sub courses for ${courseName}:\n\n`;
      options.forEach((option, index) => {
        message += `${index + 1}. ${option}\n`;
      });
      message += '\nClick OK to add the first option, or enter your own sub course.';
      
      const userChoice = prompt(message);
      if (userChoice !== null) {
        const inputBox = createSubCourseInput();
        if (userChoice.trim() === '') {
          // User clicked OK without entering anything, use first option
          inputBox.querySelector('input').value = options[0];
        } else {
          // User entered their own sub course
          inputBox.querySelector('input').value = userChoice.trim();
        }
        subCoursesContainer.appendChild(inputBox);
      }
    } else {
      alert('No predefined sub courses available for "' + courseName + '". Use the + button to add custom sub courses.');
    }
  });
  
  // Add More button functionality
  addMoreBtn.addEventListener('click', function() {
    const inputBox = createSubCourseInput();
    subCoursesContainer.appendChild(inputBox);
  });
  
  // Form submission - collect all sub courses
  document.querySelector('form').addEventListener('submit', function(e) {
    const subCourseInputs = document.querySelectorAll('#sub_courses_container input');
    const subCourses = Array.from(subCourseInputs).map(input => input.value.trim()).filter(value => value !== '');
    
    // Create hidden input for sub courses
    if (subCourses.length > 0) {
      const hiddenInput = document.createElement('input');
      hiddenInput.type = 'hidden';
      hiddenInput.name = 'sub_courses';
      hiddenInput.value = subCourses.join('|');
      document.querySelector('form').appendChild(hiddenInput);
    }
  });
});
</script>
{% endblock %}
