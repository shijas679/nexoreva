{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/course.css' %}">
{% endblock %}

{% block content %}
<div class="main-content">
  <div class="container course-list-container">
    <!-- Page Header -->
    <div class="page-header">
      <h2>
        <i class="bi bi-journal-bookmark"></i>
        Courses
      </h2>
      <div class="header-actions">
        <a href="{% url 'create_course' %}" class="btn-create-course">
          <i class="bi bi-plus-square"></i>
          Create Course
        </a>
        <a href="{% url 'add_course' %}" class="btn-add-course">
          <i class="bi bi-plus-circle"></i>
          Add Course
        </a>
      </div>
    </div>

    <!-- Courses Table -->
    <div class="table-section">
      <div class="table-wrapper">
        {% csrf_token %}
        <table class="styled-table course-table">
          <thead>
            <tr>
              <th class="col-num">#</th>
              <th class="col-name">Course Name</th>
              <th class="col-sub">Sub Column</th>
              <th class="col-unicode">Course code</th>
              <th class="col-start">Start Date</th>
              <th class="col-end">End Date</th>
              <th class="col-fees">Fees</th>
              <th class="col-actions">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for course in courses %}
            <tr class="course-row">
              <td class="col-num">{{ forloop.counter }}</td>
              <td class="col-name">
                <div class="course-name-cell">{{ course.name }}</div>
              </td>
              <td class="col-sub">{{ course.sub_column }}</td>
              <td class="col-unicode">
                <div class="unicode-cell">{{ course.unicode }}</div>
              </td>
              <td class="col-start date-cell">{{ course.start_date|date:"M d, Y" }}</td>
              <td class="col-end date-cell">{{ course.end_date|date:"M d, Y" }}</td>
              <td class="col-fees">
                <div class="fees-cell">â‚¹{{ course.fees }}</div>
              </td>
              <td class="col-actions">
                <div class="action-buttons">
                  <a href="{% url 'course_detail' course.id %}" class="action-btn view-btn" title="View Details">
                    <i class="bi bi-eye"></i>
                  </a>
                  <a href="{% url 'edit_course' course.id %}" class="action-btn edit-btn" title="Edit Course">
                    <i class="bi bi-pencil-square"></i>
                  </a>
                  <button onclick="deleteCourse({{ course.id }}, '{{ course.name }}')" class="action-btn delete-btn" title="Delete Course">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" class="empty-state">
                <div class="empty-content">
                  <i class="bi bi-journal-bookmark"></i>
                  <h4>No courses available</h4>
                  <p>Start by creating your first course with sub-courses or add a single course.</p>
                  <div class="empty-actions">
                    <a href="{% url 'create_course' %}" class="btn-add-first create">
                      <i class="bi bi-plus-square"></i>
                      Create Course Structure
                    </a>
                    <a href="{% url 'add_course' %}" class="btn-add-first add">
                      <i class="bi bi-plus-circle"></i>
                      Add Single Course
                    </a>
                  </div>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
function deleteCourse(courseId, courseName) {
  // Create a form to submit the delete request immediately
  const form = document.createElement('form');
  form.method = 'POST';
  form.action = `/courses/${courseId}/delete/`;
  
  // Add CSRF token
  const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
  const csrfInput = document.createElement('input');
  csrfInput.type = 'hidden';
  csrfInput.name = 'csrfmiddlewaretoken';
  csrfInput.value = csrfToken;
  form.appendChild(csrfInput);
  
  // Submit the form immediately
  document.body.appendChild(form);
  form.submit();
}
</script>

{% endblock %}
