{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" href="{% static 'css/add_assignment.css' %}">

<div class="container mt-4">
    <h3>Add Work Assignment</h3>

    <!-- Staff Code + Task Code Search Form -->
    <form method="post" action="" class="form-inline mb-4">
        {% csrf_token %}
        <input type="text" name="staff_code" placeholder="Enter Staff Code" class="form-control mr-2" value="{{ staff_code }}">
        <input type="text" name="task_code" placeholder="Enter Task Code" class="form-control mr-2" value="{{ task_code }}">
        <button type="submit" class="btn btn-primary">Search</button>
    </form>

    {% if task %}
        <!-- Task Details -->
        <div class="card mb-3">
            <div class="card-body">
                <h5>Task Found:</h5>
                <p><strong>Task Title:</strong> {{ task.task_title }}</p>
                <p><strong>Description:</strong> {{ task.description }}</p>
                <p><strong>Start Date:</strong> {{ task.start_date }}</p>
                <p><strong>End Date:</strong> {{ task.end_date }}</p>
                <p><strong>Assigned To:</strong> {{ task.assigned_to.full_name }}</p>
            </div>
        </div>
    {% endif %}

    {% if staff %}
        <!-- Staff Details -->
        <div class="card mb-3">
            <div class="card-body">
                <p><strong>Name:</strong> {{ staff.full_name }}</p>
                <p><strong>Email:</strong> {{ staff.email }}</p>
                <p><strong>Department:</strong> {{ staff.department }}</p>
            </div>
        </div>

        <h5>Assign Task to {{ staff.full_name }}</h5>

        <!-- Task Assignment Form -->
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="form-group">
                <label for="id_task_code"><strong>Task Code (Auto-generated):</strong></label>
                {{ form.task_code }}
            </div>

            <div class="form-group">
                <label for="id_task_title">Task Title:</label>
                {{ form.task_title }}
            </div>

            <div class="form-group">
                <label for="id_description">Description:</label>
                {{ form.description }}
            </div>

            <div class="form-group">
                <label for="id_start_date">Start Date:</label>
                {{ form.start_date }}
            </div>

            <div class="form-group">
                <label for="id_end_date">End Date:</label>
                {{ form.end_date }}
            </div>

            <div class="form-group">
                <label for="id_attachment">Attachment:</label>
                {{ form.attachment }}
            </div>

            <input type="hidden" name="assigned_to" value="{{ staff.id }}">
            <button type="submit" class="btn btn-success">Submit Assignment</button>
        </form>

    {% elif staff_code %}
        <div class="alert alert-danger">
            No staff found with code "<strong>{{ staff_code }}</strong>".
        </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    flatpickr("input[type='date']", {
        altInput: true,
        altFormat: "F j, Y",
        dateFormat: "Y-m-d",
    });
</script>
{% endblock %}
